<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual T√©cnico - Sistema Ministerio P√∫blico</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            min-height: 100vh;
        }

        .header {
            text-align: center;
            padding: 40px 0;
            background: linear-gradient(135deg, #1976D2, #42A5F5);
            color: white;
            margin: -20px -20px 30px -20px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .nav {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 30px;
            border-radius: 8px;
            border-left: 4px solid #1976D2;
        }

        .nav h3 {
            margin-bottom: 10px;
            color: #1976D2;
        }

        .nav a {
            color: #666;
            text-decoration: none;
            margin-right: 20px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .nav a:hover {
            background: #1976D2;
            color: white;
        }

        .section {
            margin-bottom: 40px;
            scroll-margin-top: 20px;
        }

        h2 {
            color: #1976D2;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #E3F2FD;
            font-size: 1.8em;
        }

        h3 {
            color: #2E7D32;
            margin: 20px 0 15px 0;
            font-size: 1.3em;
        }

        .code-block {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }

        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .tech-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .tech-item h4 {
            color: #28a745;
            margin-bottom: 10px;
        }

        .command {
            background: #2d3748;
            color: #68d391;
            padding: 10px 15px;
            border-radius: 6px;
            font-family: monospace;
            margin: 10px 0;
        }

        .db-table {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin: 15px 0;
            overflow: hidden;
        }

        .db-table-header {
            background: #1976D2;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
        }

        .db-field {
            padding: 8px 15px;
            border-bottom: 1px solid #f1f1f1;
            font-family: monospace;
            font-size: 0.9em;
        }

        .api-endpoint {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin: 10px 0;
            overflow: hidden;
        }

        .method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 10px;
        }

        .get { background: #28a745; color: white; }
        .post { background: #007bff; color: white; }
        .put { background: #ffc107; color: black; }
        .delete { background: #dc3545; color: white; }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .nav a {
                display: block;
                margin: 5px 0;
            }
            
            .tech-stack {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Manual T√©cnico</h1>
            <div class="subtitle">Sistema Ministerio P√∫blico v1.0</div>
        </div>

        <div class="nav">
            <h3>üìö √çndice de Contenidos</h3>
            <a href="#arquitectura">Arquitectura</a>
            <a href="#tecnologias">Tecnolog√≠as</a>
            <a href="#base-datos">Base de Datos</a>
            <a href="#api">API</a>
            <a href="#instalacion">Instalaci√≥n</a>
            <a href="#testing">Testing</a>
            <a href="#seguridad">Seguridad</a>
        </div>

        <section id="arquitectura" class="section">
            <h2>üèóÔ∏è Arquitectura del Sistema</h2>
            
            <div class="highlight">
                <strong>Arquitectura de 3 Capas:</strong> Frontend (React) ‚Üí Backend (Node.js/Express) ‚Üí Base de Datos (SQL Server)
            </div>

            <h3>Componentes Principales</h3>
            <div class="tech-stack">
                <div class="tech-item">
                    <h4>Frontend</h4>
                    <p>React 18 con componentes funcionales, Context API para estado global, CSS modules para estilos.</p>
                </div>
                <div class="tech-item">
                    <h4>Backend</h4>
                    <p>Node.js con Express, middleware de autenticaci√≥n JWT, controladores RESTful.</p>
                </div>
                <div class="tech-item">
                    <h4>Base de Datos</h4>
                    <p>SQL Server con stored procedures, relaciones normalizadas, √≠ndices optimizados.</p>
                </div>
                <div class="tech-item">
                    <h4>Contenedores</h4>
                    <p>Docker para desarrollo y producci√≥n, docker-compose para orquestaci√≥n.</p>
                </div>
            </div>
        </section>

        <section id="tecnologias" class="section">
            <h2>‚öôÔ∏è Stack Tecnol√≥gico</h2>

            <h3>Backend Dependencies</h3>
            <div class="code-block">
"dependencies": {
  "express": "^4.18.2",
  "mssql": "^10.0.1",
  "jsonwebtoken": "^9.0.2",
  "cors": "^2.8.5",
  "dotenv": "^16.3.1",
  "bcrypt": "^5.1.1"
}
            </div>

            <h3>Frontend Dependencies</h3>
            <div class="code-block">
"dependencies": {
  "react": "^18.2.0",
  "react-dom": "^18.2.0",
  "axios": "^1.5.0",
  "react-router-dom": "^6.15.0"
}
            </div>
        </section>

        <section id="base-datos" class="section">
            <h2>üóÑÔ∏è Modelo de Base de Datos</h2>

            <h3>Entidades Principales</h3>

            <div class="db-table">
                <div class="db-table-header">Fiscalias</div>
                <div class="db-field">üîë id: INT IDENTITY(1,1) PRIMARY KEY</div>
                <div class="db-field">nombre: VARCHAR(100) NOT NULL</div>
                <div class="db-field">ubicacion: VARCHAR(255)</div>
            </div>

            <div class="db-table">
                <div class="db-table-header">Fiscales</div>
                <div class="db-field">üîë id: INT IDENTITY(1,1) PRIMARY KEY</div>
                <div class="db-field">nombre: VARCHAR(100) NOT NULL</div>
                <div class="db-field">email: VARCHAR(100) UNIQUE</div>
                <div class="db-field">üîó id_fiscalia: INT FOREIGN KEY</div>
            </div>

            <div class="db-table">
                <div class="db-table-header">Casos</div>
                <div class="db-field">üîë id: INT IDENTITY(1,1) PRIMARY KEY</div>
                <div class="db-field">numero_caso: VARCHAR(50) UNIQUE NOT NULL</div>
                <div class="db-field">descripcion: TEXT</div>
                <div class="db-field">estado: VARCHAR(50) DEFAULT 'pendiente'</div>
                <div class="db-field">fecha_creacion: DATETIME DEFAULT GETDATE()</div>
                <div class="db-field">üîó id_fiscal_asignado: INT FOREIGN KEY</div>
                <div class="db-field">üîó id_fiscalia: INT FOREIGN KEY</div>
            </div>

            <h3>Stored Procedures Implementados</h3>
            <div class="code-block">
-- Procedimientos principales:
sp_GetAllCasos
sp_GetCasoById
sp_CreateCaso
sp_UpdateCaso
sp_DeleteCaso
sp_GetCasosByFiscal
sp_GetEstadisticas
sp_CreateLogReasignacion
            </div>
        </section>

        <section id="api" class="section">
            <h2>üîå API Endpoints</h2>

            <h3>Autenticaci√≥n</h3>
            <div class="api-endpoint">
                <div class="code-block">
<span class="method post">POST</span> /api/auth/login
Body: { "username": "admin", "password": "secret" }
Response: { "token": "jwt_token_here" }
                </div>
            </div>

            <h3>Gesti√≥n de Casos</h3>
            <div class="api-endpoint">
                <div class="code-block">
<span class="method get">GET</span> /api/casos
Headers: Authorization: Bearer {token}
Response: Array de casos
                </div>
            </div>

            <div class="api-endpoint">
                <div class="code-block">
<span class="method post">POST</span> /api/casos
Body: {
  "numero_caso": "2024-001",
  "descripcion": "Descripci√≥n del caso",
  "id_fiscal_asignado": 1,
  "id_fiscalia": 1
}
                </div>
            </div>

            <div class="api-endpoint">
                <div class="code-block">
<span class="method put">PUT</span> /api/casos/:id
<span class="method delete">DELETE</span> /api/casos/:id
                </div>
            </div>

            <h3>Estad√≠sticas y Logs</h3>
            <div class="api-endpoint">
                <div class="code-block">
<span class="method get">GET</span> /api/estadisticas
<span class="method get">GET</span> /api/logs
                </div>
            </div>
        </section>

        <section id="instalacion" class="section">
            <h2>üöÄ Instalaci√≥n y Ejecuci√≥n</h2>

            <h3>Clonar Repositorio</h3>
            <div class="command">git clone [repository-url]<br>cd MP</div>

            <h3>Backend Setup</h3>
            <div class="command">cd backend<br>npm install</div>

            <h3>Configurar Variables de Entorno</h3>
            <div class="code-block">
# .env
DB_SERVER=localhost
DB_NAME=MinisterioPublico
DB_USER=sa
DB_PASSWORD=Admin123
JWT_SECRET=your-secret-key
PORT=3001
            </div>

            <h3>Ejecutar Base de Datos</h3>
            <div class="command">
# Con Docker
docker run -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=Admin123' \
  -p 1433:1433 --name sqlserver \
  -d mcr.microsoft.com/mssql/server:2019-latest
            </div>

            <h3>Iniciar Backend</h3>
            <div class="command">npm start<br># Servidor corriendo en http://localhost:3001</div>

            <h3>Frontend Setup</h3>
            <div class="command">cd ../frontend<br>npm install<br>npm start<br># Aplicaci√≥n en http://localhost:3000</div>

            <h3>Docker Compose (Recomendado)</h3>
            <div class="command">docker-compose up -d</div>
        </section>

        <section id="testing" class="section">
            <h2>üß™ Testing y Validaci√≥n</h2>

            <h3>Pruebas de API con cURL</h3>
            <div class="code-block">
# Login
curl -X POST http://localhost:3001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"secret"}'

# Obtener casos (con token)
curl -X GET http://localhost:3001/api/casos \
  -H "Authorization: Bearer YOUR_TOKEN"

# Crear caso
curl -X POST http://localhost:3001/api/casos \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "numero_caso": "TEST-001",
    "descripcion": "Caso de prueba",
    "id_fiscal_asignado": 1,
    "id_fiscalia": 1
  }'
            </div>

            <h3>Validaciones Implementadas</h3>
            <div class="highlight">
                <strong>Frontend:</strong> Validaci√≥n de formularios, manejo de errores de red<br>
                <strong>Backend:</strong> Validaci√≥n de datos de entrada, autenticaci√≥n JWT<br>
                <strong>Base de Datos:</strong> Constraints, foreign keys, tipos de datos
            </div>

            <h3>Pruebas de Conexi√≥n</h3>
            <div class="command">
# Verificar backend
curl http://localhost:3001/health

# Verificar base de datos
sqlcmd -S localhost -U sa -P Admin123 -Q "SELECT @@VERSION"
            </div>
        </section>

        <section id="seguridad" class="section">
            <h2>üîí Seguridad Implementada</h2>

            <h3>Medidas de Seguridad</h3>
            <div class="tech-stack">
                <div class="tech-item">
                    <h4>JWT Authentication</h4>
                    <p>Tokens con expiraci√≥n de 1 hora, verificaci√≥n en middleware.</p>
                </div>
                <div class="tech-item">
                    <h4>CORS Protection</h4>
                    <p>Configurado para permitir solo or√≠genes autorizados.</p>
                </div>
                <div class="tech-item">
                    <h4>SQL Injection Prevention</h4>
                    <p>Uso de stored procedures y par√°metros tipados.</p>
                </div>
                <div class="tech-item">
                    <h4>Environment Variables</h4>
                    <p>Credenciales y secretos en variables de entorno.</p>
                </div>
            </div>

            <h3>Configuraci√≥n de Seguridad</h3>
            <div class="code-block">
// Middleware de autenticaci√≥n
const authMiddleware = (req, res, next) => {
  const token = req.header('Authorization')?.replace('Bearer ', '');
  
  if (!token) {
    return res.status(401).json({ error: 'Token requerido' });
  }
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    res.status(401).json({ error: 'Token inv√°lido' });
  }
};
            </div>

            <div class="highlight">
                <strong>‚ö†Ô∏è Pendientes de Implementar:</strong><br>
                ‚Ä¢ Hash de contrase√±as con bcrypt<br>
                ‚Ä¢ Validaci√≥n de entrada con Joi<br>
                ‚Ä¢ Rate limiting<br>
                ‚Ä¢ Logging de seguridad
            </div>
        </section>

        <div style="text-align: center; margin-top: 50px; padding-top: 30px; border-top: 2px solid #E3F2FD; color: #666;">
            <p>üìÑ Manual T√©cnico - Sistema Ministerio P√∫blico v1.0</p>
            <p>Generado: <script>document.write(new Date().toLocaleDateString());</script></p>
        </div>
    </div>

    <script>
        // Smooth scrolling para navegaci√≥n
        document.querySelectorAll('.nav a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // Highlight de secci√≥n activa
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.nav a');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (scrollY >= sectionTop - 60) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.style.background = '';
                link.style.color = '';
                if (link.getAttribute('href') === '#' + current) {
                    link.style.background = '#1976D2';
                    link.style.color = 'white';
                }
            });
        });
    </script>
</body>
</html>